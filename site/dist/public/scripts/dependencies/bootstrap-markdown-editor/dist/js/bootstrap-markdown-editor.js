!function(a){"use strict";function b(b,c,d,e,f){if(c.length){f.show();var g=new FormData,h=0;for(h=0;h<c.length;h++)g.append("file"+h,c[h]);a.ajax({url:b,type:"POST",contentType:!1,data:g,processData:!1,cache:!1,dataType:"json"}).done(function(a){var b="";a.length>1&&(b="\n");for(var c=0;c<a.length;c++)e.insertSnippet(d,"![]("+a[c]+")"+b)}).always(function(){f.hide()})}}function c(b){var e,c=a(window).height(),d=b.offset().top;c>d&&(e=c-d,b.css("height",e+"px"))}function d(b,c){b.commands.addCommand({name:"bold",bindKey:{win:"Ctrl-B",mac:"Command-B"},exec:function(a){var b=a.session.getTextRange(a.getSelectionRange());""===b?c.insertSnippet(a,"**${1:text}**"):c.insertSnippet(a,"**"+b+"**")},readOnly:!1}),b.commands.addCommand({name:"italic",bindKey:{win:"Ctrl-I",mac:"Command-I"},exec:function(a){var b=a.session.getTextRange(a.getSelectionRange());""===b?c.insertSnippet(a,"*${1:text}*"):c.insertSnippet(a,"*"+b+"*")},readOnly:!1}),b.commands.addCommand({name:"link",bindKey:{win:"Ctrl-K",mac:"Command-K"},exec:function(a){var b=a.session.getTextRange(a.getSelectionRange());""===b?c.insertSnippet(a,"[${1:text}](http://$2)"):c.insertSnippet(a,"["+b+"](http://$1)")},readOnly:!1}),b.commands.addCommand({name:"save",bindKey:{win:"Ctrl-S",mac:"Command-S"},exec:function(b){b.session.getTextRange(b.getSelectionRange());a("#save-button").click()},readOnly:!1}),b.commands.addCommand({name:"code",bindKey:{win:"Ctrl-Y",mac:"Command-Y"},exec:function(a){var b=a.session.getTextRange(a.getSelectionRange());""===b?c.insertSnippet(a,"```\n${1:text}\n```"):c.insertSnippet(a,"```\n"+b+"\n```")},readOnly:!1})}function e(a,b){0===a.getCursorPosition().column?(a.navigateLineStart(),a.insert(b+" ")):(a.navigateLineStart(),a.insert(b+" "),a.navigateLineEnd())}function f(b,c){var d="";return d+='<div class="md-loading"><span class="md-icon-container"><span class="md-icon"></span></span></div>',d+='<div class="md-toolbar">',d+='<div class="btn-toolbar">',d+='<div class="btn-group">',d+='<button type="button" data-mdtooltip="tooltip" title="'+c.label.btnHeader1+'" class="md-btn btn btn-sm btn-default" data-btn="h1">H1</button>',d+='<button type="button" data-mdtooltip="tooltip" title="'+c.label.btnHeader2+'" class="md-btn btn btn-sm btn-default" data-btn="h2">H2</button>',d+='<button type="button" data-mdtooltip="tooltip" title="'+c.label.btnHeader3+'" class="md-btn btn btn-sm btn-default" data-btn="h3">H3</button>',d+="</div>",d+='<div class="btn-group">',d+='<button type="button" data-mdtooltip="tooltip" title="'+c.label.btnBold+'" class="md-btn btn btn-sm btn-default" data-btn="bold"><span class="glyphicon glyphicon-bold"></span></button>',d+='<button type="button" data-mdtooltip="tooltip" title="'+c.label.btnItalic+'" class="md-btn btn btn-sm btn-default" data-btn="italic"><span class="glyphicon glyphicon-italic"></span></button>',d+="</div>",d+='<div class="btn-group">',d+='<button type="button" data-mdtooltip="tooltip" title="'+c.label.btnList+'" class="md-btn btn btn-sm btn-default" data-btn="ul"><span class="glyphicon glyphicon glyphicon-list"></span></button>',d+='<button type="button" data-mdtooltip="tooltip" title="'+c.label.btnOrderedList+'" class="md-btn btn btn-sm btn-default" data-btn="ol"><span class="glyphicon glyphicon-th-list"></span></button>',!0===c.code&&(d+='<button type="button" data-mdtooltip="tooltip" title="'+c.label.btnCode+'" class="md-btn btn btn-sm btn-default"      data-btn="code"><span class="glyphicon glyphicon-console"></span></button>'),d+="</div>",d+='<div class="btn-group">',d+='<button type="button" data-mdtooltip="tooltip" title="'+c.label.btnLink+'" class="md-btn btn btn-sm btn-default" data-btn="link"><span class="glyphicon glyphicon-link"></span></button>',d+='<button type="button" data-mdtooltip="tooltip" title="'+c.label.btnImage+'" class="md-btn btn btn-sm btn-default" data-btn="image"><span class="glyphicon glyphicon-picture"></span></button>',!0===c.imageUpload&&(d+='<div data-mdtooltip="tooltip" title="'+c.label.btnUpload+'" class="btn btn-sm btn-default md-btn-file"><span class="glyphicon glyphicon-upload"></span><input class="md-input-upload" type="file" multiple accept=".jpg,.jpeg,.png,.gif"></div>'),d+="</div>",!0===c.fullscreen&&(d+='<div class="btn-group pull-right">',d+='<button type="button" class="md-btn btn btn-sm btn-default" data-btn="fullscreen"><span class="glyphicon glyphicon-fullscreen"></span> '+c.label.btnFullscreen+"</button>",d+="</div>"),!0===c.preview&&(d+='<div class="btn-group pull-right">',d+='<button type="button" class="md-btn btn btn-sm btn-default btn-save" data-btn="save"><span class="glyphicon glyphicon-floppy-disk"></span> '+c.label.btnSave+"</button>",d+='<button type="button" class="md-btn btn btn-sm btn-default btn-edit active" data-btn="edit"><span class="glyphicon glyphicon-pencil"></span> '+c.label.btnEdit+"</button>",d+='<button type="button" class="md-btn btn btn-sm btn-default btn-preview" data-btn="preview"><span class="glyphicon glyphicon-eye-open"></span> '+c.label.btnPreview+"</button>",d+="</div>"),d+="</div>",d+="</div>",d+='<div class="md-editor">'+a("<div>").text(b).html()+"</div>",d+='<div class="md-preview" style="background-color: white; display:none"></div>'}var g={init:function(g){var j,h=a.extend(!0,{},a.fn.markdownEditor.defaults,g),i=this,k=!1,l=!1;i.addClass("md-textarea-hidden"),j=a("<div/>"),i.after(j),j.addClass("md-container").html(f(i.val(),h)),"function"==typeof a().tooltip&&j.find('[data-mdtooltip="tooltip"]').tooltip({container:"body"});var m=j.find(".md-editor"),n=j.find(".md-preview"),o=j.find(".md-loading");j.css({width:h.width}),m.css({height:h.height,fontSize:h.fontSize}),n.css({height:h.height});var q,p=ace.edit(m[0]);return p.setTheme("ace/theme/"+h.theme),p.getSession().setMode("ace/mode/markdown"),p.getSession().setUseWrapMode(!0),p.getSession().setUseSoftTabs(h.softTabs),p.getSession().on("change",function(){i.val(p.getSession().getValue())}),p.setHighlightActiveLine(!1),p.setShowPrintMargin(!1),p.renderer.setShowGutter(!1),ace.config.loadModule("ace/ext/language_tools",function(){q=ace.require("ace/snippets").snippetManager,d(p,q)}),i.data("md-editor",p),h.imageUpload&&(j.find(".md-input-upload").on("change",function(){var c=a(this).get(0).files;b(h.uploadPath,c,p,q,o)}),j.on("dragenter",function(a){a.stopPropagation(),a.preventDefault()}),j.on("dragover",function(a){a.stopPropagation(),a.preventDefault()}),j.on("drop",function(a){a.preventDefault();var c=a.originalEvent.dataTransfer.files;b(h.uploadPath,c,p,q,o)})),!0===h.fullscreen&&a(window).resize(function(){!0===l&&c(!1===k?m:n)}),j.find(".md-btn").click(function(){var b=a(this).data("btn"),d=p.session.getTextRange(p.getSelectionRange());"h1"===b?e(p,"#"):"h2"===b?e(p,"##"):"h3"===b?e(p,"###"):"ul"===b?q.insertSnippet(p,"<ul>\n<li> $1 </li>\n</ul>"):"ol"===b?q.insertSnippet(p,"<ol>\n<li> $1 </li>\n</ol>"):"bold"===b?p.execCommand("bold"):"italic"===b?p.execCommand("italic"):"link"===b?p.execCommand("link"):"image"===b?""===d?q.insertSnippet(p,"![${1:alt-text}](image-id)"):q.insertSnippet(p,"!["+d+"](image-id)"):"edit"===b?(k=!1,n.hide(),m.show(),j.find(".btn-edit").addClass("active"),j.find(".btn-preview").removeClass("active"),!0===l&&c(m)):"preview"===b?(k=!0,n.html('<p style="text-align:center; font-size:16px">'+h.label.loading+"...</p>"),h.onPreview(p.getSession().getValue(),function(a){n.html(a)}),m.hide(),n.show(),j.find(".btn-preview").addClass("active"),j.find(".btn-edit").removeClass("active"),!0===l&&c(n)):"fullscreen"===b?(!0===l?(l=!1,a("body, html").removeClass("md-body-fullscreen"),j.removeClass("md-fullscreen"),m.css("height",h.height),n.css("height",h.height)):(l=!0,a("body, html").addClass("md-body-fullscreen"),j.addClass("md-fullscreen"),c(!1===k?m:n)),p.resize()):"save"==b?a("#save-button").click():"code"==b&&p.execCommand("code"),p.focus()}),this},content:function(){var a=this.data("md-editor");return console.log(a.getSession().getValue()),a.getSession().getValue()},setContent:function(a){var b=this.data("md-editor");console.log(a),b.setValue(a,1)},editor:function(){return this.data("md-editor")}};a.fn.markdownEditor=function(b){if(g[b]){if("init"===b||this.data("md-editor"))return g[b].apply(this,Array.prototype.slice.call(arguments,1));a.error("This object has not been initialized as a Markdown Editor.")}else{if("object"==typeof b||!b)return g.init.apply(this,arguments);a.error("Method "+b+" does not exist on jQuery.markdownEditor")}},a.fn.markdownEditor.defaults={width:"100%",height:"400px",fontSize:"14px",theme:"tomorrow",softTabs:!0,fullscreen:!0,imageUpload:!1,uploadPath:"",preview:!1,onPreview:function(a,b){b(a)},label:{btnHeader1:"Header 1",btnHeader2:"Header 2",btnHeader3:"Header 3",btnBold:"Bold",btnItalic:"Italic",btnList:"Unordered list",btnOrderedList:"Ordered list",btnLink:"Link",btnImage:"Insert image",btnUpload:"Upload image",btnEdit:"Edit",btnPreview:"Preview",btnFullscreen:"Fullscreen",loading:"Loading",btnSave:"Save",btnCode:"Code"}}}(jQuery);