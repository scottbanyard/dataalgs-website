!function(t){"use strict";function n(n,e,a,i,o){if(e.length){o.show();var l=new FormData,s=0;for(s=0;s<e.length;s++)l.append("file"+s,e[s]);t.ajax({url:n,type:"POST",contentType:!1,data:l,processData:!1,cache:!1,dataType:"json"}).done(function(t){var n="";t.length>1&&(n="\n");for(var e=0;e<t.length;e++)i.insertSnippet(a,"![]("+t[e]+")"+n)}).always(function(){o.hide()})}}function e(n){var e,a=t(window).height(),i=n.offset().top;a>i&&(e=a-i,n.css("height",e+"px"))}function a(n,e){n.commands.addCommand({name:"bold",bindKey:{win:"Ctrl-B",mac:"Command-B"},exec:function(t){var n=t.session.getTextRange(t.getSelectionRange());""===n?e.insertSnippet(t,"**${1:text}**"):e.insertSnippet(t,"**"+n+"**")},readOnly:!1}),n.commands.addCommand({name:"italic",bindKey:{win:"Ctrl-I",mac:"Command-I"},exec:function(t){var n=t.session.getTextRange(t.getSelectionRange());""===n?e.insertSnippet(t,"*${1:text}*"):e.insertSnippet(t,"*"+n+"*")},readOnly:!1}),n.commands.addCommand({name:"link",bindKey:{win:"Ctrl-K",mac:"Command-K"},exec:function(t){var n=t.session.getTextRange(t.getSelectionRange());""===n?e.insertSnippet(t,"[${1:text}](http://$2)"):e.insertSnippet(t,"["+n+"](http://$1)")},readOnly:!1}),n.commands.addCommand({name:"save",bindKey:{win:"Ctrl-S",mac:"Command-S"},exec:function(n){n.session.getTextRange(n.getSelectionRange());t("#save-button").click()},readOnly:!1}),n.commands.addCommand({name:"code",bindKey:{win:"Ctrl-Y",mac:"Command-Y"},exec:function(t){var n=t.session.getTextRange(t.getSelectionRange());""===n?e.insertSnippet(t,"```\n${1:text}\n```"):e.insertSnippet(t,"```\n"+n+"\n```")},readOnly:!1})}function i(t,n){0===t.getCursorPosition().column?(t.navigateLineStart(),t.insert(n+" ")):(t.navigateLineStart(),t.insert(n+" "),t.navigateLineEnd())}function o(n,e){var a="";return a+='<div class="md-loading"><span class="md-icon-container"><span class="md-icon"></span></span></div>',a+='<div class="md-toolbar">',a+='<div class="btn-toolbar">',a+='<div class="btn-group">',a+='<button type="button" data-mdtooltip="tooltip" title="'+e.label.btnHeader1+'" class="md-btn btn btn-sm btn-default" data-btn="h1">H1</button>',a+='<button type="button" data-mdtooltip="tooltip" title="'+e.label.btnHeader2+'" class="md-btn btn btn-sm btn-default" data-btn="h2">H2</button>',a+='<button type="button" data-mdtooltip="tooltip" title="'+e.label.btnHeader3+'" class="md-btn btn btn-sm btn-default" data-btn="h3">H3</button>',a+="</div>",a+='<div class="btn-group">',a+='<button type="button" data-mdtooltip="tooltip" title="'+e.label.btnBold+'" class="md-btn btn btn-sm btn-default" data-btn="bold"><span class="glyphicon glyphicon-bold"></span></button>',a+='<button type="button" data-mdtooltip="tooltip" title="'+e.label.btnItalic+'" class="md-btn btn btn-sm btn-default" data-btn="italic"><span class="glyphicon glyphicon-italic"></span></button>',a+="</div>",a+='<div class="btn-group">',a+='<button type="button" data-mdtooltip="tooltip" title="'+e.label.btnList+'" class="md-btn btn btn-sm btn-default" data-btn="ul"><span class="glyphicon glyphicon glyphicon-list"></span></button>',a+='<button type="button" data-mdtooltip="tooltip" title="'+e.label.btnOrderedList+'" class="md-btn btn btn-sm btn-default" data-btn="ol"><span class="glyphicon glyphicon-th-list"></span></button>',e.code===!0&&(a+='<button type="button" data-mdtooltip="tooltip" title="'+e.label.btnCode+'" class="md-btn btn btn-sm btn-default"      data-btn="code"><span class="glyphicon glyphicon-console"></span></button>'),a+="</div>",a+='<div class="btn-group">',a+='<button type="button" data-mdtooltip="tooltip" title="'+e.label.btnLink+'" class="md-btn btn btn-sm btn-default" data-btn="link"><span class="glyphicon glyphicon-link"></span></button>',a+='<button type="button" data-mdtooltip="tooltip" title="'+e.label.btnImage+'" class="md-btn btn btn-sm btn-default" data-btn="image"><span class="glyphicon glyphicon-picture"></span></button>',e.imageUpload===!0&&(a+='<div data-mdtooltip="tooltip" title="'+e.label.btnUpload+'" class="btn btn-sm btn-default md-btn-file"><span class="glyphicon glyphicon-upload"></span><input class="md-input-upload" type="file" multiple accept=".jpg,.jpeg,.png,.gif"></div>'),a+="</div>",e.fullscreen===!0&&(a+='<div class="btn-group pull-right">',a+='<button type="button" class="md-btn btn btn-sm btn-default" data-btn="fullscreen"><span class="glyphicon glyphicon-fullscreen"></span> '+e.label.btnFullscreen+"</button>",a+="</div>"),e.preview===!0&&(a+='<div class="btn-group pull-right">',a+='<button type="button" class="md-btn btn btn-sm btn-default btn-save" data-btn="save"><span class="glyphicon glyphicon-floppy-disk"></span> '+e.label.btnSave+"</button>",a+='<button type="button" class="md-btn btn btn-sm btn-default btn-edit active" data-btn="edit"><span class="glyphicon glyphicon-pencil"></span> '+e.label.btnEdit+"</button>",a+='<button type="button" class="md-btn btn btn-sm btn-default btn-preview" data-btn="preview"><span class="glyphicon glyphicon-eye-open"></span> '+e.label.btnPreview+"</button>",a+="</div>"),a+="</div>",a+="</div>",a+='<div class="md-editor">'+t("<div>").text(n).html()+"</div>",a+='<div class="md-preview" style="display:none"></div>'}var l={init:function(l){var s,d=t.extend(!0,{},t.fn.markdownEditor.defaults,l),b=this,c=!1,p=!1;b.addClass("md-textarea-hidden"),s=t("<div/>"),b.after(s),s.addClass("md-container").html(o(b.val(),d)),"function"==typeof t().tooltip&&s.find('[data-mdtooltip="tooltip"]').tooltip({container:"body"});var r=s.find(".md-editor"),u=s.find(".md-preview"),m=s.find(".md-loading");s.css({width:d.width}),r.css({height:d.height,fontSize:d.fontSize}),u.css({height:d.height});var g,h=ace.edit(r[0]);return h.setTheme("ace/theme/"+d.theme),h.getSession().setMode("ace/mode/markdown"),h.getSession().setUseWrapMode(!0),h.getSession().setUseSoftTabs(d.softTabs),h.getSession().on("change",function(){b.val(h.getSession().getValue())}),h.setHighlightActiveLine(!1),h.setShowPrintMargin(!1),h.renderer.setShowGutter(!1),ace.config.loadModule("ace/ext/language_tools",function(){g=ace.require("ace/snippets").snippetManager,a(h,g)}),b.data("md-editor",h),d.imageUpload&&(s.find(".md-input-upload").on("change",function(){var e=t(this).get(0).files;n(d.uploadPath,e,h,g,m)}),s.on("dragenter",function(t){t.stopPropagation(),t.preventDefault()}),s.on("dragover",function(t){t.stopPropagation(),t.preventDefault()}),s.on("drop",function(t){t.preventDefault();var e=t.originalEvent.dataTransfer.files;n(d.uploadPath,e,h,g,m)})),d.fullscreen===!0&&t(window).resize(function(){p===!0&&e(c===!1?r:u)}),s.find(".md-btn").click(function(){var n=t(this).data("btn"),a=h.session.getTextRange(h.getSelectionRange());"h1"===n?i(h,"#"):"h2"===n?i(h,"##"):"h3"===n?i(h,"###"):"ul"===n?i(h,"*"):"ol"===n?i(h,"1."):"bold"===n?h.execCommand("bold"):"italic"===n?h.execCommand("italic"):"link"===n?h.execCommand("link"):"image"===n?""===a?g.insertSnippet(h,"![${1:text}](http://$2)"):g.insertSnippet(h,"!["+a+"](http://$1)"):"edit"===n?(c=!1,u.hide(),r.show(),s.find(".btn-edit").addClass("active"),s.find(".btn-preview").removeClass("active"),p===!0&&e(r)):"preview"===n?(c=!0,u.html('<p style="text-align:center; font-size:16px">'+d.label.loading+"...</p>"),d.onPreview(h.getSession().getValue(),function(t){u.html(t)}),r.hide(),u.show(),s.find(".btn-preview").addClass("active"),s.find(".btn-edit").removeClass("active"),p===!0&&e(u)):"fullscreen"===n?(p===!0?(p=!1,t("body, html").removeClass("md-body-fullscreen"),s.removeClass("md-fullscreen"),r.css("height",d.height),u.css("height",d.height)):(p=!0,t("body, html").addClass("md-body-fullscreen"),s.addClass("md-fullscreen"),e(c===!1?r:u)),h.resize()):"save"==n?t("#save-button").click():"code"==n&&h.execCommand("code"),h.focus()}),this},content:function(){var t=this.data("md-editor");return console.log(t.getSession().getValue()),t.getSession().getValue()},setContent:function(t){var n=this.data("md-editor");console.log(t),n.setValue(t,1)},editor:function(){return this.data("md-editor")}};t.fn.markdownEditor=function(n){if(l[n]){if("init"===n||this.data("md-editor"))return l[n].apply(this,Array.prototype.slice.call(arguments,1));t.error("This object has not been initialized as a Markdown Editor.")}else{if("object"==typeof n||!n)return l.init.apply(this,arguments);t.error("Method "+n+" does not exist on jQuery.markdownEditor")}},t.fn.markdownEditor.defaults={width:"100%",height:"400px",fontSize:"14px",theme:"tomorrow",softTabs:!0,fullscreen:!0,imageUpload:!1,uploadPath:"",preview:!1,onPreview:function(t,n){n(t)},label:{btnHeader1:"Header 1",btnHeader2:"Header 2",btnHeader3:"Header 3",btnBold:"Bold",btnItalic:"Italic",btnList:"Unordered list",btnOrderedList:"Ordered list",btnLink:"Link",btnImage:"Insert image",btnUpload:"Upload image",btnEdit:"Edit",btnPreview:"Preview",btnFullscreen:"Fullscreen",loading:"Loading",btnSave:"Save",btnCode:"Code"}}}(jQuery);
